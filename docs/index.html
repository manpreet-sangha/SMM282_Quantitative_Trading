<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limit Order Book Simulator | SMM282 Quantitative Trading</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Limit Order Book Simulator</h1>
            <p class="subtitle">SMM282 Quantitative Trading - Price-Visibility-Time Priority</p>
        </header>

        <div class="info-panel">
            <h3>üìö Matching Priority Rules</h3>
            <div class="rules">
                <div class="rule">
                    <span class="rule-num">1</span>
                    <div>
                        <strong>Price First</strong>
                        <p>Buy orders with higher limit prices get priority. Sell orders with lower limit prices get priority.</p>
                    </div>
                </div>
                <div class="rule">
                    <span class="rule-num">2</span>
                    <div>
                        <strong>Visibility</strong>
                        <p>Visible orders get priority over hidden orders at the same price level.</p>
                    </div>
                </div>
                <div class="rule">
                    <span class="rule-num">3</span>
                    <div>
                        <strong>Time (FIFO)</strong>
                        <p>Earlier submitted orders get priority at the same price and visibility.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Mode Selection -->
            <div class="mode-selection" id="modeSelection">
                <h2>Choose Demo Mode</h2>
                <div class="mode-buttons">
                    <button class="btn btn-mode" onclick="selectMode('sample')">
                        <span class="mode-icon">üìã</span>
                        <span class="mode-title">Load Sample Orders</span>
                        <span class="mode-desc">Pre-loaded orders from lecture example sorted by arrival time</span>
                    </button>
                    <button class="btn btn-mode" onclick="selectMode('custom')" disabled>
                        <span class="mode-icon">‚úèÔ∏è</span>
                        <span class="mode-title">Custom Order Book</span>
                        <span class="mode-desc">Create your own orders (Coming Soon)</span>
                    </button>
                </div>
            </div>

            <!-- Sample Orders Demo Section -->
            <div class="demo-panel" id="sampleDemo" style="display: none;">
                <div class="demo-header-bar">
                    <h2>üìã Limit Order Processing - Buy Orders Priority Rules</h2>
                    <button class="btn btn-secondary btn-small" onclick="backToModeSelection()">‚Üê Back</button>
                </div>

                <div class="demo-controls">
                    <button class="btn btn-primary" onclick="processLimitOrderBook()" id="processBtn">
                        ‚ñ∂ Apply Price Priority
                    </button>
                    <button class="btn btn-secondary" onclick="resetDemo()">‚Ü∫ Reset</button>
                </div>

                <!-- Horizontal columns layout -->
                <div id="stepsContainer" class="steps-horizontal">
                    <!-- Column 1: Arrival Order -->
                    <div class="step-column" id="stepCol1">
                        <div class="column-header">
                            <span class="col-step-num">1</span>
                            <span class="col-title">Arrival Time</span>
                        </div>
                        <div class="compact-table">
                            <div class="compact-header">
                                <span>Price</span>
                                <span>Vis</span>
                                <span>Time</span>
                                <span>T#</span>
                            </div>
                            <div id="ordersStep1" class="compact-rows"></div>
                        </div>
                    </div>

                    <!-- Arrow between columns -->
                    <div class="step-arrow" id="arrow1" style="display: none;">
                        <div class="arrow-label">Price ‚Üì</div>
                        <div class="arrow-icon">‚Üí</div>
                    </div>

                    <!-- Column 2: Price Priority -->
                    <div class="step-column" id="stepCol2" style="display: none;">
                        <div class="column-header highlight-price">
                            <span class="col-step-num">2</span>
                            <span class="col-title">+ Price</span>
                        </div>
                        <div class="compact-table">
                            <div class="compact-header">
                                <span>Price</span>
                                <span>Vis</span>
                                <span>Time</span>
                                <span>T#</span>
                                <span>Œî</span>
                            </div>
                            <div id="ordersStep2" class="compact-rows"></div>
                        </div>
                    </div>

                    <!-- Arrow between columns -->
                    <div class="step-arrow" id="arrow2" style="display: none;">
                        <div class="arrow-label">Visibility</div>
                        <div class="arrow-icon">‚Üí</div>
                    </div>

                    <!-- Column 3: Visibility Priority -->
                    <div class="step-column" id="stepCol3" style="display: none;">
                        <div class="column-header highlight-visibility">
                            <span class="col-step-num">3</span>
                            <span class="col-title">+ Visibility</span>
                        </div>
                        <div class="compact-table">
                            <div class="compact-header">
                                <span>Price</span>
                                <span>Vis</span>
                                <span>Time</span>
                                <span>T#</span>
                                <span>Œî</span>
                            </div>
                            <div id="ordersStep3" class="compact-rows"></div>
                        </div>
                    </div>

                    <!-- Arrow between columns -->
                    <div class="step-arrow" id="arrow3" style="display: none;">
                        <div class="arrow-label">Time</div>
                        <div class="arrow-icon">‚Üí</div>
                    </div>

                    <!-- Column 4: Time Priority (Final) -->
                    <div class="step-column final-column" id="stepCol4" style="display: none;">
                        <div class="column-header highlight-time">
                            <span class="col-step-num">4</span>
                            <span class="col-title">+ Time</span>
                        </div>
                        <div class="compact-table">
                            <div class="compact-header final-header">
                                <span>Price</span>
                                <span>Vis</span>
                                <span>Time</span>
                                <span>T#</span>
                                <span>Œî</span>
                            </div>
                            <div id="ordersStep4" class="compact-rows"></div>
                        </div>
                        <div class="final-badge">‚úì Final Priority</div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="demo-legend">
                    <span class="legend-item"><span class="arrow-up">‚Üë</span> Moved Up</span>
                    <span class="legend-item"><span class="arrow-down">‚Üì</span> Moved Down</span>
                    <span class="legend-item"><span class="arrow-same">‚àí</span> Same Position</span>
                </div>
            </div>

            <!-- Custom Order Book Section (Future) -->
            <div class="custom-panel" id="customDemo" style="display: none;">
                <div class="demo-header-bar">
                    <h2>‚úèÔ∏è Custom Order Book</h2>
                    <button class="btn btn-secondary btn-small" onclick="backToModeSelection()">‚Üê Back</button>
                </div>
                <p>Custom order book feature coming soon...</p>
            </div>
        </div>

        <!-- Hidden sections for future use -->
        <div class="bottom-section" id="bottomSection" style="display: none;">
            <div class="trades-section">
                <h2>üí± Trade History</h2>
                <div class="trades-table">
                    <div class="trades-header">
                        <span>Trade ID</span>
                        <span>Buy Order</span>
                        <span>Sell Order</span>
                        <span>Price</span>
                        <span>Quantity</span>
                        <span>Time</span>
                    </div>
                    <div id="tradesContainer" class="trades-rows"></div>
                </div>
            </div>

            <div class="orders-section">
                <h2>üìã All Orders</h2>
                <div class="orders-table">
                    <div class="orders-header">
                        <span>ID</span>
                        <span>Side</span>
                        <span>Price</span>
                        <span>Qty</span>
                        <span>Filled</span>
                        <span>Visible</span>
                        <span>Status</span>
                        <span>Action</span>
                    </div>
                    <div id="ordersContainer" class="orders-rows"></div>
                </div>
            </div>
        </div>

        <div class="visualization-section" id="vizSection" style="display: none;">
            <h2>üìä Depth Chart</h2>
            <canvas id="depthChart"></canvas>
        </div>

        <!-- Hidden form for order book functionality -->
        <form id="orderForm" style="display: none;">
            <input type="text" id="orderId">
            <select id="side"><option value="BUY">BUY</option></select>
            <input type="number" id="price" value="100">
            <input type="number" id="quantity" value="100">
            <input type="checkbox" id="isVisible" checked>
        </form>
        <div style="display: none;">
            <span id="bestBid"></span>
            <span id="bestAsk"></span>
            <span id="spread"></span>
            <span id="midpoint"></span>
            <div id="asksContainer"></div>
            <div id="bidsContainer"></div>
        </div>

        <footer>
            <p>SMM282 Quantitative Trading | City St George's, University of London</p>
            <p><a href="https://github.com/manpreet-sangha/SMM282_Quantitative_Trading" target="_blank">View on GitHub</a></p>
        </footer>
    </div>

    <script src="js/order-book.js"></script>
    <script src="js/visualization.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
